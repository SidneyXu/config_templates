apply plugin: 'com.android.library'

android {
    compileSdkVersion 21
    buildToolsVersion "21.1.2"

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_7
        targetCompatibility JavaVersion.VERSION_1_7
    }
    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

task("upload", dependsOn: "build"){

}

uploadArchives {

    repositories.mavenDeployer {
        name = 'mavenCentralReleaseDeployer'
        snapshotRepository(url: "http://127.0.0.1:8081/nexus/content/repositories/snapshots/") {
            authentication(userName: "admin", password: "admin123")
        }
        pom.version = "1.0.1-SNAPSHOT"
        pom.artifactId = "android-lib"
        pom.groupId = "com.example"
        pom.name = "android lib example"
        pom.packaging = 'aar'
    }
}

android.libraryVariants.all { variant ->
    task("generate${variant.name}Javadoc", type: Javadoc) {
        description "Generates Javadoc for $variant.name."
        source = variant.javaCompile.source
        ext.androidJar = "${android.sdkDirectory}/platforms/${android.compileSdkVersion}/android.jar"
        classpath = files(variant.javaCompile.classpath.files) + files(ext.androidJar)

        //android
        exclude "**/R.java"

        //other
        exclude '**/demo/**'
    }

    task("javadoc${variant.name}", type: Jar) {
        classifier = "javadoc"
        description "Bundles Javadoc into a JAR file for $variant.name."
        from tasks["generate${variant.name}Javadoc"]

    }

    task("jar${variant.name}", type: Jar) {
        description "Bundles compiled .class files into a JAR file for $variant.name."
        dependsOn variant.javaCompile
        from variant.javaCompile.destinationDir
        exclude '**/R.class', '**/R$*.class', '**/R.html', '**/R.*.html','BuildConfig.class'
        exclude '**/test/'
    }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    compile 'com.android.support:appcompat-v7:22.0.0'
    compile 'com.example:java-lib:1.0.1-SNAPSHOT'
}


apply plugin: 'maven-publish'
publishing {
    publications {

        repositories.maven {
            url "http://127.0.0.1:8081/nexus/content/repositories/snapshots/"
            credentials {
                username "admin"
                password "admin123"
            }
        }

        maven(MavenPublication) {
            artifacts {
                groupId 'com.android'
                artifactId 'mymy'
                version '1.0-SNAPSHOT'
                artifact 'build/outputs/aar/example-android-lib-release.aar'
            }
        }
    }
    //snapshot only allow published version name contains snapshot

}